# Item 28: Prefer Lists to Arrays

## Main Takeaway

> Arrays and generics have very different type rules. Arrays are **covariant** and **reified**; generics are **invariant** and **erased**. As a consequence, arrays provide runtime type safety but not compile-time-type safety, and vice versa for generics. As a rule, arrays and generics don't mix well. If you find yourself mixing them and getting compile-time errors or warnings, your first impulse should be to replace the arrays with lists.

## Definitions

### Covariance (arrays) vs. Invariance (generics)

#### Covariance

Arrays are covariant. This means that if `Sub` is a subtype of `Super`, then the array type `Sub[]` is a subtype of the array type `Super[]`.

#### Invariance

Generics are invariant: for any two distinct types `Type1` and `Type2`, `List<Type1>` is neither a subtype nor supertype of `List<Type2>`.

#### Differences

Due to array covariance, any class mismatch will result in an error at runtime; but with a list, the invariant errors are exposed at compile time.

```java
//Fails at runtime 
Object[] objectArray = new Long[1];
objectArray[0] = "Will not work"; //Throws ArrayStoreException


//Won't Compile
List<Object> ol = new ArrayList<Long>(); // Incompatible types
ol.add("I won't even reach here");
```

### Reifiable (arrays) vs Non-Reifiable / Type Erasure (generics)

#### Reifiable

Arrays are reified, meaning that arrays know and enforce their element type at runtime.

#### Non-Reifiable

A non-reifiable type is one whose runtime representation contains less information that its compile-time representation.

Generics (`E`, `List<E>` and `List<String>` are non-reifiable.

#### Type Erasure

Type erasure means that type constraints are only enforced at compile time, and are discarded (erased) at runtime.

Generics are implemented by erasure. This allows them to interoperate with legacy (Java 5) code.

Together with being non-reifiable, the only parameterized types that are reifiable are unbounded wildcard types such as List<?> or Map<?,?>.

## Other Notes (WIP)

> Why is it illegal to create a generic array? Because it isn't typesafe. If it were legal, casts generated by the compiler in an otherwise correct program could fail at runtime with a ClassCastException. This would violate the fundamental guarantee provided by the generic type system.

## Pro-Tips (WIP)

When you get a generic array creation error or an unchecked cast warning on a cast to an array type, the best solution is often to use the collection type `List<E>` in preference to the array type `E[]`. You might sacrifice some conciseness or performance, but in exchange you get better type safety and interoperability.

## Navigation

- [All Items](../README.md#items)
- [Previous](./item-27-eliminate-unchecked-warnings.md)
- [Next](./item-28-prefer-lists-to-arrays.md)
